import{h as j,i as h,j as M,u as L,o as D,a as v,c as g,b as t,t as u,d as l,f as S,F as I,r as T,e as B,k as N,w as V,l as A,v as F,m as H,p as z,n as C}from"./app-BXe2DA_a.js";const O=j("chat",()=>{const o=h([]),a=h(null),i=h(!1),r=h(null),m=h("Anonymous"),c=h(null);async function b(e){var n,y;if(!e.trim())return;const s=Date.now();o.value.push({id:s,role:"human",content:e,created_at:new Date().toISOString()}),i.value=!0,r.value=null,c.value=null;try{const d=await M.post("/api/v1/chat",{message:e,conversation_id:a.value,participant_name:m.value});a.value=d.data.conversation_id;const f=o.value.find(E=>E.id===s);f&&(f.id=d.data.user_message_id);const _=d.data.error===!0;o.value.push({id:d.data.id||Date.now()+1,role:_?"system":"entity",content:d.data.message,thought_process:d.data.thought_process,created_at:d.data.created_at,isError:_}),_&&(c.value=d.data.user_message_id,r.value=d.data.error_details||"LLM nicht erreichbar")}catch(d){r.value=((y=(n=d.response)==null?void 0:n.data)==null?void 0:y.message)||d.message,o.value.push({id:Date.now()+1,role:"system",content:"Ich kann gerade nicht antworten. Bitte prüfe die Modelanbindung.",created_at:new Date().toISOString(),isError:!0});const f=o.value.find(_=>_.id===s);f&&(c.value=f.id)}finally{i.value=!1}}async function k(){var e,s;if(c.value){o.value=o.value.filter(n=>!n.isError),i.value=!0,r.value=null;try{const n=await M.post("/api/v1/chat/retry",{message_id:c.value});a.value=n.data.conversation_id;const y=n.data.error===!0;o.value.push({id:n.data.id||Date.now()+1,role:y?"system":"entity",content:n.data.message,thought_process:n.data.thought_process,created_at:n.data.created_at,isError:y}),y?r.value=n.data.error_details||"LLM nicht erreichbar":c.value=null}catch(n){r.value=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||n.message,o.value.push({id:Date.now()+1,role:"system",content:"Ich kann gerade nicht antworten. Bitte prüfe die Modelanbindung.",created_at:new Date().toISOString(),isError:!0})}finally{i.value=!1}}}async function x(){if(a.value){i.value=!0;try{const e=await M.get("/api/v1/chat/history",{params:{conversation_id:a.value}});e.data.conversation&&(o.value=e.data.conversation.messages||[]),r.value=null}catch(e){r.value=e.message}finally{i.value=!1}}}function w(){o.value=[],a.value=null,c.value=null,r.value=null}function p(){window.Echo&&window.Echo.channel("entity.chat").listen(".message.received",e=>{e.conversation_id===a.value&&(o.value.some(n=>n.id===e.id)||o.value.push(e))})}return{messages:o,conversationId:a,isLoading:i,error:r,participantName:m,lastFailedMessageId:c,sendMessage:b,retryLastMessage:k,loadHistory:x,startNewConversation:w,subscribeToMessages:p}}),U={class:"flex flex-col h-full min-h-0 bg-gray-50 dark:bg-gray-950 transition-colors duration-200"},q={class:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-6 py-4 transition-colors duration-200"},G={class:"flex items-center justify-between"},J={class:"flex items-center gap-3"},K={class:"w-10 h-10 rounded-full bg-gradient-to-br from-entity-500 to-purple-600 flex items-center justify-center shadow-lg"},P={class:"text-xl"},Q={class:"font-semibold text-gray-900 dark:text-gray-100"},R={class:"text-sm text-gray-500 dark:text-gray-400"},W={key:0,class:"text-center py-12"},X={class:"w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},Y={class:"text-4xl"},Z={class:"text-gray-500 dark:text-gray-400 max-w-md mx-auto"},$={key:0,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg px-4 py-3 max-w-md"},ee={class:"flex items-center gap-2 text-red-700 dark:text-red-400"},te={class:"text-sm font-medium"},se={class:"text-xs mt-1 text-red-500 dark:text-red-500"},ae={class:"whitespace-pre-wrap"},ne={class:"text-xs mt-1 opacity-60"},re={key:1,class:"flex justify-center"},oe={key:2,class:"flex justify-start"},ie={class:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-4 transition-colors duration-200"},le=["disabled"],de=["disabled"],ue={__name:"Chat",setup(o){const a=O(),i=L(),r=h(""),m=h(null),c=H(()=>r.value.trim()&&!a.isLoading);async function b(){if(!c.value)return;const p=r.value;r.value="",await a.sendMessage(p),await x()}async function k(){await a.retryLastMessage(),await x()}async function x(){await z(),m.value&&(m.value.scrollTop=m.value.scrollHeight)}function w(p){return new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return D(()=>{a.subscribeToMessages()}),(p,e)=>(v(),g("div",U,[t("div",q,[t("div",G,[t("div",J,[t("div",K,[t("span",P,u(l(i).moodEmoji),1)]),t("div",null,[t("h2",Q,"Chat with "+u(l(i).name),1),t("p",R,u(l(i).isAwake?"Active":"Sleeping"),1)])]),t("button",{onClick:e[0]||(e[0]=(...s)=>l(a).startNewConversation&&l(a).startNewConversation(...s)),class:"btn btn-secondary text-sm"}," New Conversation ")])]),t("div",{ref_key:"messagesContainer",ref:m,class:"flex-1 min-h-0 overflow-y-auto p-6 space-y-4 scroll-smooth"},[l(a).messages.length===0?(v(),g("div",W,[t("div",X,[t("span",Y,u(l(i).moodEmoji),1)]),e[2]||(e[2]=t("h3",{class:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100"},"Start a Conversation",-1)),t("p",Z," Say hello to "+u(l(i).name)+". This isn't just a chatbot - it's an entity with its own thoughts, interests, and personality. ",1)])):S("",!0),(v(!0),g(I,null,T(l(a).messages,s=>(v(),g("div",{key:s.id,class:C(["flex",{"justify-start":s.role==="entity"||s.role==="system","justify-end":s.role==="human","justify-center":s.isError}])},[s.isError?(v(),g("div",$,[t("div",ee,[e[3]||(e[3]=t("svg",{class:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("p",te,u(s.content),1)]),t("p",se,u(w(s.created_at)),1)])):(v(),g("div",{key:1,class:C(["chat-message",s.role==="entity"?"chat-message-entity":"chat-message-human"])},[t("p",ae,u(s.content),1),t("p",ne,u(w(s.created_at)),1)],2))],2))),128)),l(a).lastFailedMessageId&&!l(a).isLoading?(v(),g("div",re,[t("button",{onClick:k,class:"flex items-center gap-2 px-4 py-2 bg-entity-500 hover:bg-entity-600 text-white rounded-lg transition-colors text-sm font-medium"},[...e[4]||(e[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),B(" Erneut versuchen ",-1)])])])):S("",!0),l(a).isLoading?(v(),g("div",oe,[...e[5]||(e[5]=[N('<div class="chat-message chat-message-entity"><div class="flex gap-1.5 py-1"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div></div>',1)])])):S("",!0)],512),t("div",ie,[t("form",{onSubmit:V(b,["prevent"]),class:"flex gap-3"},[A(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),type:"text",class:"input flex-1",placeholder:"Say something...",disabled:l(a).isLoading},null,8,le),[[F,r.value]]),t("button",{type:"submit",class:"btn btn-primary px-6",disabled:!c.value},[...e[6]||(e[6]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],8,de)],32)])]))}};export{ue as default};
